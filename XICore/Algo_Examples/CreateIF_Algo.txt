Adding current finance rValue amount to parent finance rValue
-------------------------------------------------------

v1

xi.ag_Financial_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:BOI_a:m.BOLoad_x:bod.FinancialLevel,[ID=xim.BOIID]
xi.m_-:CurrentValue_a:m.SetValue_x:xim.BOI.rValue
xi.m_-:FinanceParentID_a:m.SetValue_x:xim.BOI.FKiFinanceParentID
xi.m_-:ParentBOI_a:m.BOLoad_x:bod.FinancialLevel,[ID=xim.FinanceParentID]
xi.m_-:ParentValue_a:m.SetValue_x:xim.ParentBOI.rValue
xi.s_-:SumCost_x:{add|xim.CurrentValue,xim.ParentValue}
xi.m_-:SetValue1_a:m.SetValue_x:xim.ParentBOI,[rValue=xim.SumCost]
xi.m_-:UpdateCost_a:m.BOSave_x:xim.ParentBOI

v2

xi.ag_Financial_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:BOI_a:m.BOLoad_x:bod.FinancialLevel,[ID=xim.BOIID]
xi.m_-:CurrentValue_a:m.SetValue_x:xim.BOI.rValue
xi.m_-:FinanceParentID_a:m.SetValue_x:xim.BOI.FKiFinanceParentID
xi.m_-:IfParentID_a:m.Condition_x:{if|{gt|{xim|FinanceParentID},'0'},'y','n'}
xi.m_--:ParentBOI_a:m.BOLoad_x:bod.FinancialLevel,[ID=xim.FinanceParentID]
xi.m_--:ParentValue_a:m.SetValue_x:xim.ParentBOI.rValue
xi.s_--:SumCost_x:{add|xim.CurrentValue,xim.ParentValue}
xi.m_--:SetValue1_a:m.SetValue_x:xim.ParentBOI,[rValue=xim.SumCost]
xi.m_--:UpdateCost_a:m.BOSave_x:xim.ParentBOI


v3

xi.ag_Financial_p.sSessionID,p.sGUID

xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:BOI_a:m.BOLoad_x:bod.FinancialLevel,[ID=xim.BOIID]
xi.m_-:CurrentValue_a:m.SetValue_x:xim.BOI.rValue
xi.m_-:FinanceParentID_a:m.SetValue_x:xim.BOI.FKiFinanceParentID
xi.m_-:Recursive_a:m.Recursive_x:xim.FinanceParentID
xi.m_--:ParentBOI_a:m.BOLoad_x:bod.FinancialLevel,[ID=xim.FinanceParentID]
xi.m_--:ParentValue_a:m.SetValue_x:xim.ParentBOI.rValue
xi.s_--:SumCost_x:{add|xim.CurrentValue,xim.ParentValue}
xi.m_--:SetValue1_a:m.SetValue_x:xim.ParentBOI,[rValue=xim.SumCost]
xi.m_--:UpdateCost_a:m.BOSave_x:xim.ParentBOI
xi.m_--:SetValue2_a:m.SetLineValue_x:FinanceParentID,xim.ParentBOI.FKiFinanceParentID



v4

xi.ag_Financial_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.s_-:OldValue_x:{xi.p|-oldvalue}
xi.s_-:NewValue_x:{xi.p|-newvalue}
xi.m_-:IfParentID_a:m.Condition_x:{if|{ne|{xim|OldValue},{xim|NewValue}},'y','n'}
xi.m_--:BOI_a:m.BOLoad_x:bod.FinancialLevel,[ID=xim.BOIID]
xi.m_--:CurrentValue_a:m.SetValue_x:xim.BOI.rValue
xi.m_--:FinanceParentID_a:m.SetValue_x:xim.BOI.FKiFinanceParentID
xi.m_--:Recursive_a:m.Recursive_x:xim.FinanceParentID
xi.m_---:ParentBOI_a:m.BOLoad_x:bod.FinancialLevel,[ID=xim.FinanceParentID]
xi.m_---:ParentValue_a:m.SetValue_x:xim.ParentBOI.rValue
xi.s_---:SumCost_x:{add|xim.CurrentValue,xim.ParentValue}
xi.m_---:SetValue1_a:m.SetValue_x:xim.ParentBOI,[rValue=xim.SumCost]
xi.m_---:UpdateCost_a:m.BOSave_x:xim.ParentBOI
xi.m_---:SetValue2_a:m.SetLineValue_x:FinanceParentID,xim.ParentBOI.FKiFinanceParentID



--------------------------------------------------------------


Import Template Algorithm

v1

xi.ag_ImportTemplate_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.s_-:QSIID_x:{xi.p|-iQSIID}
xi.m_-:QSI_a:m.LoadQS_x:xim.QSIID
xi.m_-:TemplateID_a:m.SetValue_x:xim.QSI.iTemplate
xi.m_-:TemplateFinancial_a:m.1Click_x:xif.TemplateFinancial,[FKiProjectID=xim.QSI.iTemplate]
xi.m_-:EachFinancial_a:m.Iterate_x:xim.TemplateFinancial
xi.m_--:CreateFinancialInstance_a:m.CreateBO_x:bod.FinancialLevel
xi.m_--:CopyFinancial_a:m.BOCopy_x:xic.EachFinancial,xim.CreateFinancialInstance,xif.Create
xi.m_--:SetValue1_a:m.SetValue_x:xim.CreateFinancialInstance,[FKiProjectID=xim.BOIID]
xi.m_--:InsertFinancial_a:m.BOSave_x:xim.CreateFinancialInstance


v2

xi.ag_ImportTemplate_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.s_-:QSIID_x:{xi.p|-iQSIID}
xi.m_-:QSI_a:m.LoadQS_x:xim.QSIID
xi.m_-:TemplateID_a:m.SetValue_x:xim.QSI.iTemplate
xi.m_-:TemplateFinancial_a:m.1Click_x:xif.TemplateFinancial,[FKiProjectID=xim.QSI.iTemplate]
xi.m_-:EachFinancial_a:m.Iterate_x:xim.TemplateFinancial
xi.m_--:FinanceParentID_a:m.SetValue_x:xim.EachFinancial.ID
xi.m_--:CreateFinancialInstance_a:m.CreateBO_x:bod.FinancialLevel
xi.m_--:CopyFinancial_a:m.BOCopy_x:xic.EachFinancial,xim.CreateFinancialInstance,xif.Create
xi.m_--:SetValue1_a:m.SetValue_x:xim.CreateFinancialInstance,[FKiProjectID=xim.BOIID]
xi.m_--:InsertFinancial_a:m.BOSave_x:xim.CreateFinancialInstance
xi.m_--:NewFinanceParentID_a:m.SetValue_x:xim.CreateFinancialInstance.ID
xi.m_--:Recursive_a:m.Recursive_x:xim.FinanceParentID
xi.m_---:TemplateFinancialChild_a:m.1Click_x:xif.TemplateFinancialChild,[FKiFinanceParentID=xim.FinanceParentID]
xi.m_---:EachFinancialChild_a:m.Iterate_x:xim.TemplateFinancialChild
xi.m_----:FinanceParentIDChild_a:m.SetValue_x:xim.EachFinancialChild.ID
xi.m_----:CreateFinancialInstanceChild_a:m.CreateBO_x:bod.FinancialLevel
xi.m_----:CopyFinancialChild_a:m.BOCopy_x:xic.EachFinancialChild,xim.CreateFinancialInstanceChild,xif.Create
xi.m_----:SetValue2_a:m.SetValue_x:xim.CreateFinancialInstanceChild,[FKiProjectID=xim.BOIID]
xi.m_----:SetValue4_a:m.SetValue_x:xim.CreateFinancialInstanceChild,[FKiFinanceParentID=xim.NewFinanceParentID]
xi.m_----:InsertFinancialChild_a:m.BOSave_x:xim.CreateFinancialInstanceChild
xi.m_----:NewFinanceParentIDChild_a:m.SetValue_x:xim.CreateFinancialInstanceChild.ID
xi.m_----:SetValue3_a:m.SetLineValue_x:FinanceParentID=xim.EachFinancialChild.ID


v3

xi.ag_ImportTemplate_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.s_-:QSIID_x:{xi.p|-iQSIID}
xi.m_-:QSI_a:m.LoadQS_x:xim.QSIID
xi.m_-:TemplateFinancial_a:m.1Click_x:xif.TemplateFinancial,[FKiProjectID=xim.QSI.iTemplate]
//xi.m_-:EachFinancial_a:m.Iterate_x:xim.TemplateFinancial
xi.m_-:Recursive_a:m.Recursive_x:xim.TemplateFinancial,xim.NewFinanceParentID
xi.m_--:CreateFinancialInstance_a:m.CreateBO_x:bod.FinancialLevel
xi.m_--:CopyFinancial_a:m.BOCopy_x:xic.Recursive,xim.CreateFinancialInstance,xif.Create
xi.m_--:SetValue1_a:m.SetValue_x:xim.CreateFinancialInstance,[FKiProjectID=xim.BOIID]
xi.m_--:NewParentID_a:m.GetArray_x:xim.FinancialArray,xim.CreateFinancialInstance.FKiFinanceParentID
xi.m_--:SetValue2_a:m.SetValue_x:xim.CreateFinancialInstance,[FKiFinanceParentID=xim.NewParentID]
xi.m_--:InsertFinancial_a:m.BOSave_x:xim.CreateFinancialInstance
xi.m_--:FinanceParentID_a:m.SetValue_x:xim.Recursive.ID
xi.m_--:NewFinanceParentID_a:m.SetValue_x:xim.CreateFinancialInstance.ID
xi.m_--:FinancialArray_a:m.SetArray_x:xim.Recursive.ID,xim.CreateFinancialInstance.ID
xi.m_--:TemplateFinancialChild_a:m.1Click_x:xif.TemplateFinancialChild,[FKiFinanceParentID=xim.FinanceParentID]
xi.m_--:SetValue3_a:m.SetLineValue_x:TemplateFinancial=xim.TemplateFinancialChild





xi.ag|DiaryTemplate|p.PolicyFK,p.dGoLive,p.TemplateID
xi.m|-:TemplateDiaries|a:m.1Click|x:xif.templatediaries
xi.m|-:PolicyI|a:m.BOLoad|x:bod.Policy_T,p.PolicyFK
xi.s|-:CL12|x:{if|{eq|{xi.p|'-clientid'},'12'},'y','n'}
xi.s|-:ManagerCode|x:{if|{=|{xi.qsxivalue|scode},{xi.a|'Code_T',{xi.r|currentuser},'sCode','sUser'}},'true','false'}
xi.m|-:EachDiaryT|a:m.Iterate|x:xim.TemplateDiaries
xi.m|--:CreateDiaryInstance|a:m.CreateBO|x:bod.Diary_T
xi.m|--:CopyDiary|a:m.BOCopy|x:xic.EachDiaryT,xim.CreateDiaryInstance,xif.CopyLive
xi.m|--:SetValue1|a:m.SetValue|x:xim.CreateDiaryInstance,[dDue=xim.EachDiary.iDaysFromZero+p.dGoLive]
xi.m|--:SetValue2|c:xis.ManagerCode|a:m.SetValue|x:xim.CreateDiaryInstance,[iType=0]
xi.m|--:IfClient7|a:m.Condition|x:{if|{eq|{xi.p|'-clientid'},'7'},'y','n'}
xi.m|---:SetValue3|a:m.SetValue|x:xim.CreateDiaryInstance,[FKiPolicyID=p.PolicyID]
xi.m|--:SetValue4|cn:xis.CL12|a:m.SetValue|x:xim.CreateDiaryInstance,[FKiClientID=xim.PolicyI.FKiClientID]
xi.m|--:InsertDiary|a:m.BOSave|x:xim.CreateDiaryInstance
xi.s|--:Total|x:{if|{eq|{xim.InsertDiary},0},{increment|xis.Total,1},xis.Total}
xi.s|-:Summary|x:{concat|xis.Total,' Diaries have been created'}




Legal Quote Cal

xi.ag_QuoteCalculation_p.sSessionID,p.sGUID
xi.m_-:RunScript_a:m.RunScript_x:10368

xi.ag_InsertLegalLead_p.sSessionID,p.sGUID&xi.s_-:QSIID_x:{xi.p|-iQSIID}&xi.m_-:QSI_a:m.LoadQS_x:xim.QSIID&xi.m_-:LegalI_a:m.BOLoad_x:bod.LegalLead&xi.m_-:SetValue1_a:m.SetValue_x:xim.LegalI,[sName=xim.QSI.RDPFirstNane]&xi.m_-:SetValue2_a:m.SetValue_x:xim.LegalI,[sDescription=xim.QSI.RDPLastName]&xi.m_-:SetValue3_a:m.SetValue_x:xim.LegalI,[sEmail=xim.QSI.RDPEmail]&xi.m_-:SetValue4_a:m.SetValue_x:xim.LegalI,[iPhone=xim.QSI.RDPPhoneNumber]&xi.m_-:SetValue5_a:m.SetValue_x:xim.LegalI,[sPostcode=xim.QSI.RDPPostcode]&xi.m_-:SetValue6_a:m.SetValue_x:xim.LegalI,[iStatus=x:0]&xi.m_-:InsertLegal_a:m.BOSave_x:xim.LegalI

xi.ag_InsertLegalLead_p.sSessionID,p.sGUID&xi.s_-:QSIID_x:{xi.p|-iQSIID}&xi.m_-:QSI_a:m.LoadQS_x:xim.QSIID&xi.m_-:LegalI_a:m.BOLoad_x:bod.LegalLead&xi.m_-:SetValue1_a:m.SetValue_x:xim.LegalI,[sName=xim.QSI.sLGFirstName]&xi.m_-:SetValue2_a:m.SetValue_x:xim.LegalI,[sDescription=xim.QSI.sLastName]&xi.m_-:SetValue3_a:m.SetValue_x:xim.LegalI,[sEmail=xim.QSI.Email]&xi.m_-:SetValue4_a:m.SetValue_x:xim.LegalI,[iPhone=xim.QSI.PhoneNumber]&xi.m_-:SetValue5_a:m.SetValue_x:xim.LegalI,[sPostcode=xim.QSI.sPostCode]&xi.m_-:SetValue6_a:m.SetValue_x:xim.LegalI,[iStatus=x:0]&xi.m_-:InsertLegal_a:m.BOSave_x:xim.LegalI

xi.ag_InsertLegalLead_p.sSessionID,p.sGUID&xi.s_-:QSIID_x:{xi.p|-iQSIID}&xi.m_-:QSI_a:m.LoadQS_x:xim.QSIID&xi.m_-:LegalI_a:m.BOLoad_x:bod.LegalLead&xi.m_-:SetValue1_a:m.SetValue_x:xim.LegalI,[sName=xim.QSI.RDPFirstNane]&xi.m_-:SetValue2_a:m.SetValue_x:xim.LegalI,[sDescription=xim.QSI.RDPLastName]&xi.m_-:SetValue3_a:m.SetValue_x:xim.LegalI,[sEmail=xim.QSI.RDPEmail]&xi.m_-:SetValue4_a:m.SetValue_x:xim.LegalI,[iPhone=xim.QSI.RDPPhoneNumber]&xi.m_-:SetValue5_a:m.SetValue_x:xim.LegalI,[sPostcode=xim.QSI.RDPPostcode]&xi.m_-:SetValue6_a:m.SetValue_x:xim.LegalI,[iStatus=x:0]&xi.m_-:InsertLegal_a:m.BOSave_x:xim.LegalI

xi.ag_InsertLegalLead_p.sSessionID,p.sGUID&xi.s_-:QSIID_x:{xi.p|-iQSIID}&xi.m_-:QSI_a:m.LoadQS_x:xim.QSIID&xi.m_-:LegalI_a:m.BOLoad_x:bod.LegalLead&xi.m_-:SetValue1_a:m.SetValue_x:xim.LegalI,[sName=xim.QSI.CBFirstname]&xi.m_-:SetValue2_a:m.SetValue_x:xim.LegalI,[sDescription=xim.QSI.CBLastname]&xi.m_-:SetValue3_a:m.SetValue_x:xim.LegalI,[sEmail=xim.QSI.CBEmail]&xi.m_-:SetValue4_a:m.SetValue_x:xim.LegalI,[iPhone=xim.QSI.CBPhone]&xi.m_-:SetValue5_a:m.SetValue_x:xim.LegalI,[sPostcode=xim.QSI.CBpostcode]&xi.m_-:SetValue6_a:m.SetValue_x:xim.LegalI,[iStatus=x:0]&xi.m_-:InsertLegal_a:m.BOSave_x:xim.LegalI

xi.ag_InsertLegalLead_p.sSessionID,p.sGUID&xi.s_-:QSIID_x:{xi.p|-iQSIID}&xi.m_-:QSI_a:m.LoadQS_x:xim.QSIID&xi.m_-:LegalI_a:m.BOLoad_x:bod.LegalLead&xi.m_-:SetValue1_a:m.SetValue_x:xim.LegalI,[sName=xim.QSI.DVFirstname]&xi.m_-:SetValue2_a:m.SetValue_x:xim.LegalI,[sDescription=xim.QSI.DVLastname]&xi.m_-:SetValue3_a:m.SetValue_x:xim.LegalI,[sEmail=xim.QSI.DVEmail]&xi.m_-:SetValue4_a:m.SetValue_x:xim.LegalI,[iPhone=xim.QSI.DVPhone]&xi.m_-:SetValue5_a:m.SetValue_x:xim.LegalI,[sPostcode=xim.QSI.DVpostcode]&xi.m_-:SetValue6_a:m.SetValue_x:xim.LegalI,[iStatus=x:0]&xi.m_-:InsertLegal_a:m.BOSave_x:xim.LegalI

xi.ag_InsertLegalLead_p.sSessionID,p.sGUID&xi.s_-:QSIID_x:{xi.p|-iQSIID}&xi.m_-:QSI_a:m.LoadQS_x:xim.QSIID&xi.m_-:LegalI_a:m.BOLoad_x:bod.LegalLead&xi.m_-:SetValue1_a:m.SetValue_x:xim.LegalI,[sName=xim.QSI.FMFirstname]&xi.m_-:SetValue2_a:m.SetValue_x:xim.LegalI,[sDescription=xim.QSI.FMLastname]&xi.m_-:SetValue3_a:m.SetValue_x:xim.LegalI,[sEmail=xim.QSI.FMemail]&xi.m_-:SetValue4_a:m.SetValue_x:xim.LegalI,[iPhone=xim.QSI.FmPhone]&xi.m_-:SetValue5_a:m.SetValue_x:xim.LegalI,[sPostcode=xim.QSI.FMpostcode]&xi.m_-:SetValue6_a:m.SetValue_x:xim.LegalI,[iStatus=x:0]&xi.m_-:InsertLegal_a:m.BOSave_x:xim.LegalI

xi.ag_InsertLegalLead_p.sSessionID,p.sGUID&xi.s_-:QSIID_x:{xi.p|-iQSIID}&xi.m_-:QSI_a:m.LoadQS_x:xim.QSIID&xi.m_-:LegalI_a:m.BOLoad_x:bod.LegalLead&xi.m_-:SetValue1_a:m.SetValue_x:xim.LegalI,[sName=xim.QSI.CPfirstname]&xi.m_-:SetValue2_a:m.SetValue_x:xim.LegalI,[sDescription=xim.QSI.CPlastname]&xi.m_-:SetValue3_a:m.SetValue_x:xim.LegalI,[sEmail=xim.QSI.CPemail]&xi.m_-:SetValue4_a:m.SetValue_x:xim.LegalI,[iPhone=xim.QSI.CPphone]&xi.m_-:SetValue6_a:m.SetValue_x:xim.LegalI,[iStatus=x:0]&xi.m_-:InsertLegal_a:m.BOSave_x:xim.LegalI



Convert Legal Lead

xi.ag_ConvertLead_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:LeadI_a:m.BOLoad_x:bod.LegalLead,[ID=xim.BOIID]
xi.m_-:SetValue1_a:m.SetValue_x:xim.LeadI,[iStatus=xif.10]
xi.m_-:UpdateLead_a:m.BOSave_x:xim.LeadI
xi.m_-:LegalI_a:m.BOLoad_x:bod.Legal_T
xi.m_-:sName_a:m.SetValue_x:xim.LeadI.sName
xi.m_-:SetValue2_a:m.SetValue_x:xim.LegalI,[sName=xim.sName]
xi.m_-:SaveLegal_a:m.BOSave_x:xim.LegalI


xi.ag_ConvertLead_p.sSessionID,p.sGUID&xi.s_-:BOIID_x:{xi.p|-iBOIID}&xi.m_-:LeadI_a:m.BOLoad_x:bod.LegalLead,[ID=xim.BOIID]&xi.m_-:SetValue1_a:m.SetValue_x:xim.LeadI,[iStatus=xif.10]&xi.m_-:UpdateLead_a:m.BOSave_x:xim.LeadI&xi.m_-:LegalI_a:m.BOLoad_x:bod.Legal_T&xi.m_-:sName_a:m.SetValue_x:xim.LeadI.sName&xi.m_-:SetValue2_a:m.SetValue_x:xim.LegalI,[sName=xim.sName]&xi.m_-:SaveLegal_a:m.BOSave_x:xim.LegalI



H M Sanctions

xi.ag_HMSanction_p.sSessionID,p.sGUID
xi.s_-:QSIID_x:{xi.p|-iQSIID}
xi.m_-:QSI_a:m.LoadQS_x:xim.QSIID
xi.m_-:QSBOI_a:m.BOLoad_x:bod.QS Instance,[ID=xim.QSIID]
xi.m_-:SetCacheFN_a:m.SetCache_x:{XIP|sFirstName},xim.QSI.sFirstName
xi.m_-:SetCacheLN_a:m.SetCache_x:{XIP|sLastName},xim.QSI.sFirstName
xi.m_-:DOB_a:m.Function_x:ConvertDate,xim.QSI.dDOB,dd-MM-yyyy
xi.m_-:SetCacheDOB_a:m.SetCache_x:{XIP|dDOB},xim.DOB
xi.m_-:SetCacheCID_a:m.SetCache_x:{XIP|FKiClassID},xim.QSBOI.FKiClassID
xi.m_-:SanctionList_a:m.1Click_x:xif.SanctionList
xi.m_-:Count_a:m.Function_x:Count,xim.SanctionList
xi.m_-:IfCounteq_a:m.Condition_x:{if|{eq|{xim|Count},0},'y','n'}
xi.m_--:LegalProducts_a:m.1Click_x:xif.LegalActive ProductsList
xi.m_--:EachProduct_a:m.Iterate_x:xim.LegalProducts
xi.m_---:BOI_a:m.BOLoad_x:bod.LegalProductVersion,[FKiProductID=xim.EachProduct.ID]
xi.m_---:RunScript_a:m.RunScript_x:xim.BOI.FKiScriptID,xim.QSIID
xi.m_--:SetNextStep1_a:m.SetCache_x:NextStep,xif.More Details
xi.m_-:IfCountgt_a:m.Condition_x:{if|{gt|{xim|Count},0},'y','n'}
xi.m_--:LogI_a:m.CreateBO_x:bod.ErrorLog
xi.m_--:SetValue1_a:m.SetValue_x:xim.LogI,[Name=xif.Sanction Issue]
xi.m_--:SetValue2_a:m.SetValue_x:xim.LogI,[Description=xif.Sanction Exception]
xi.m_--:SetValue3_a:m.SetValue_x:xim.LogI,[sCategory=xif.Regulation Exception]
xi.m_--:SetValue4_a:m.SetValue_x:xim.LogI,[FKiQSinstanceID=xim.QSIID]
xi.m_--:SetValue5_a:m.SetValue_x:xim.LogI,[iCriticality=xif.30]
xi.m_--:SaveLogI_a:m.BOSave_x:xim.LogI
xi.m_--:SetNextStep2_a:m.SetCache_x:NextStep,xif.HMFailure



Success Script
xi.m_-:SetCacheCID_a:m.SetCache_x:{XIP|FKiClassID},xif.2
xi.m_-:SetCachePDT_a:m.SetCache_x:{XIP|dPolicyDate},xif.2021-04-07
xi.m_-:LegalProducts_a:m.1Click_x:xif.LegalActive ProductsList
xi.m_-:EachProduct_a:m.Iterate_x:xim.LegalProducts
xi.m_--:BOI_a:m.BOLoad_x:bod.LegalProductVersion,[FKiProductID=xim.EachProduct.ID]
xi.m_--:RunScript_a:m.RunScript_x:xim.BOI.FKiScriptID


Error Log

xi.m_-:LogI_a:m.CreateBO_x:bod.ErrorLog
xi.m_-:SetValue1_a:m.SetValue_x:xim.LogI,[Name=xif.Sanction Issue]
xi.m_-:SetValue2_a:m.SetValue_x:xim.LogI,[Description=xif.Sanction Exception]
xi.m_-:SetValue3_a:m.SetValue_x:xim.LogI,[sCategory=xif.Regulation Exception]
xi.m_-:SetValue4_a:m.SetValue_x:xim.LogI,[FKiQSinstaceID=xim.QSIID]


Quotes without HMS

xi.ag_HMSanction_p.sSessionID,p.sGUID
xi.s_-:QSIID_x:{xi.p|-iQSIID}
xi.m_-:QSI_a:m.LoadQS_x:xim.QSIID
xi.m_-:QSBOI_a:m.BOLoad_x:bod.QS Instance,[ID=xim.QSIID]
xi.m_-:SetCacheFN_a:m.SetCache_x:{XIP|sFirstName},xim.QSI.sFirstName
xi.m_-:SetCacheLN_a:m.SetCache_x:{XIP|sLastName},xim.QSI.sFirstName
xi.m_-:DOB_a:m.Function_x:ConvertDate,xim.QSI.dDOB,dd-MM-yyyy
xi.m_-:SetCacheDOB_a:m.SetCache_x:{XIP|dDOB},xim.DOB
xi.m_-:SetCacheCID_a:m.SetCache_x:{XIP|FKiClassID},xim.QSBOI.FKiClassID
xi.m_-:LegalProducts_a:m.1Click_x:xif.LegalActive ProductsList
xi.m_-:EachProduct_a:m.Iterate_x:xim.LegalProducts
xi.m_--:BOI_a:m.BOLoad_x:bod.LegalProductVersion,[FKiProductID=xim.EachProduct.ID]
xi.m_--:RunScript_a:m.RunScript_x:xim.BOI.FKiScriptID,xim.QSIID


1Query Permission

xi.m_-:Roles_a:m.1Click_x:xif.AllOrgRoles,[FKiOrganizationID=xim.QSI.iTemplate]
xi.m_-:EachFinancial_a:m.Iterate_x:xim.TemplateFinancial



xi.ag_XI1ClickPermission_T.sSessionID,p.sGUID
xi.m_-:All1Clicks_a:m.Iterate_x:xim.Algo Test
xi.m_--:XI1Click_a:m.BOLoad_x:bod.1Query Permission
xi.m_--:SetValue1_a:m.SetValue_x:xim.XI1Click,[iFKi1ClickID=xim.All1Clicks.ID]
xi.m_--:SetValue2_a:m.SetValue_x:xim.XI1Click,[iFKiRoleID=xif.2]
xi.m_--:XI1ClickPermission_a:m.BOSave_x:xim.XI1Click




xi.ag_Lead.sSessionID,p.sGUID
xi.s_-:SignalRID_x:{xi.p|-iSignalRID}
xi.m_-:SettingI_a:m.BOLoad_x:bod.XISignalRUsersSettings,[ID=xim.SignalRID]
xi.s_-:BO_x:{xi.p|-sBO}
xi.s_-:BODID_x:{xi.p|-iBODID}
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:BOI_a:m.BOLoad_x:xim.BO,[ID=xim.BOIID]
xi.m_-:Template_a:m.TemplateMerge_x:xif.LeadNotification,xim.BO,xim.BOI
xi.m_-:LeadI_a:m.BOLoad_x:bod.Notifications
xi.m_-:SetValue1_a:m.SetValue_x:xim.LeadI,[FKiBODID=xim.BODID]
xi.m_-:SetValue2_a:m.SetValue_x:xim.LeadI,[FKiBOIID=xim.BOIID]
xi.m_-:SetValue3_a:m.SetValue_x:xim.LeadI,[sMessage=xim.Template]
xi.m_-:SetValue4_a:m.SetValue_x:xim.LeadI,[iType=xim.SettingI.iCategory]
xi.m_-:SetValue5_a:m.SetValue_x:xim.LeadI,[iStatus=xif.30]
xi.m_-:InsertNotification_a:m.BOSave_x:xim.LeadI





xi.ag_Lead.sSessionID,p.sGUID
xi.s_-:QSIID_x:{xi.p|-iQSIID}
xi.m_-:QSI_a:m.QSLoad_x:xim.QSIID
xi.m_-:LeadI_a:m.BOLoad_x:bod.Lead
xi.m_-:SetValue1_a:m.SetValue_x:xim.LeadI,[sFirstName=xim.QSI.sFirstName]
xi.m_-:SetValue2_a:m.SetValue_x:xim.LeadI,[FKiBOIID=xim.BOIID]
xi.m_-:SetValue3_a:m.SetValue_x:xim.LeadI,[sMessage=xim.Template]
xi.m_-:SetValue4_a:m.SetValue_x:xim.LeadI,[iType=xim.SettingI.iCategory]
xi.m_-:SetValue5_a:m.SetValue_x:xim.LeadI,[iStatus=xif.30]
xi.m_-:InsertLead_a:m.BOSave_x:xim.LeadI




xi.ag_NotificationQS.sSessionID,p.sGUID
xi.s_-:BO_x:{xi.p|-sBO}
xi.s_-:BODID_x:{xi.p|-iBODID}
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:QSI_a:m.QSInsert_x:xif.Critical Error Notification
xi.m_-:NotificationI_a:m.BOLoad_x:bod.Notifications,[ID=xim.BOIID]
xi.m_-:SetValue1_a:m.SetValue_x:xim.NotificationI,[FKiQSInstanceID=xim.QSI]
xi.m_-:UpdateNotificationI_a:m.BOSave_x:xim.NotificationI


HAL K2 START

1. Updating total evaluation calculation by summing up child totals and current node evaluationa and saving history of evaluation

xi.ag_Total Evaluation_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:EvalI_a:m.BOLoad_x:bod.Evaluation,[ID=xim.BOIID]
xi.m_-:CurrentEval_a:m.SetValue_x:xim.EvalI.iEvaluation
xi.m_-:CurrentTotal_a:m.SetValue_x:xim.EvalI.iTotalEvaluation
xi.m_-:ChildEvals_a:m.1Click_x:xif.TotalEvaluation,[FKiParentID=xim.BOIID]
xi.m_-:Count_a:m.Function_x:Count,xim.ChildEvals
xi.m_-:IfCountgt_a:m.Condition_x:{if|{gt|{xim|Count},0},'y','n'}
xi.m_--:EachChild_a:m.Iterate_x:xim.ChildEvals
xi.m_---:ChildTotal_a:m.SetValue_x:xim.EachChild.iTotalEvaluation
xi.s_---:Total_x:{increment|xis.Total,xim.ChildTotal}
xi.s_--:TotalEval_x:{add|xim.CurrentEval,xis.Total}
xi.m_--:SetTotalValue1_a:m.SetValue_x:xim.EvalI,[iTotalEvaluation=xim.TotalEval]
xi.m_-:IfCounteq_a:m.Condition_x:{if|{eq|{xim|Count},0},'y','n'}
xi.m_-:SetTotalValue2_a:m.SetValue_x:xim.EvalI,[iTotalEvaluation=xim.CurrentEval]
xi.m_-:UpdateEvalI_a:m.BOSave_x:xim.EvalI
xi.m_-:Today_a:m.SetValue_x:xid.Today
xi.m_-:EvalHistoryPrevI_a:m.BOLoad_x:bod.EvaluationHistory,[iCurrent=xim.CurrentTotal,FKiEvaluationID=xim.BOIID]
xi.m_-:SetdtTo_a:m.SetValue_x:xim.EvalHistoryPrevI,[dtTo=xim.Today]
xi.m_-:UpdateEvalHistoryPrevI_a:m.BOSave_x:xim.EvalHistoryPrevI
xi.m_-:EvalHistoryI_a:m.BOLoad_x:bod.EvaluationHistory
xi.m_-:SetFKEvalID_a:m.SetValue_x:xim.EvalHistoryI,[FKiEvaluationID=xim.BOIID]
xi.m_-:SetPrevious_a:m.SetValue_x:xim.EvalHistoryI,[iPrevious=xim.CurrentTotal]
xi.m_-:SetCurrent_a:m.SetValue_x:xim.EvalHistoryI,[iCurrent=xim.EvalI.iTotalEvaluation]
xi.m_-:SetFrom_a:m.SetValue_x:xim.EvalHistoryI,[dtFrom=xim.Today]
xi.m_-:SetDescription_a:m.SetValue_x:xim.EvalHistoryI,[sDescription=xim.EvalI.sDescription]
xi.m_-:UpdateEvalHistoryI_a:m.BOSave_x:xim.EvalHistoryI


2. Updating parent node total evaluation count recussively and saving history of each node

xi.ag_Total Evaluation_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:EvalI_a:m.BOLoad_x:bod.Evaluation,[ID=xim.BOIID]
xi.m_-:CurrentTotal_a:m.SetValue_x:xim.EvalI.iTotalEvaluation
xi.m_-:EvalParentID_a:m.SetValue_x:xim.EvalI.FKiParentID
xi.m_-:Recursive_a:m.Recursive_x:xim.EvalParentID
xi.m_--:ParentEvalI_a:m.BOLoad_x:bod.Evaluation,[ID=xim.EvalParentID]
xi.m_--:CurrentParentTotal_a:m.SetValue_x:xim.ParentEvalI.iTotalEvaluation
xi.m_--:ParentEvaluation_a:m.SetValue_x:xim.ParentEvalI.iEvaluation
xi.s_--:TotalEval_x:{add|xim.ParentEvaluation,xis.CurrentTotal}
xi.m_--:SetTotalValue_a:m.SetValue_x:xim.ParentEvalI,[iTotalEvaluation=xim.TotalEval]
xi.m_--:UpdateEvalI_a:m.BOSave_x:xim.ParentEvalI
xi.m_--:SetValue2_a:m.SetLineValue_x:EvalParentID=xim.ParentEvalI.FKiParentID
xi.m_--:SetValue3_a:m.SetLineValue_x:CurrentTotal=xim.TotalEval
xi.m_--:EvalHistoryI_a:m.BOLoad_x:bod.EvaluationHistory
xi.m_--:SetFKEvalID_a:m.SetValue_x:xim.EvalHistoryI,[FKiEvaluationID=xim.ParentEvalI.ID]
xi.m_--:SetPrevious_a:m.SetValue_x:xim.EvalHistoryI,[iPrevious=xim.CurrentParentTotal]
xi.m_--:SetCurrent_a:m.SetValue_x:xim.EvalHistoryI,[iCurrent=xim.TotalEval]
xi.m_--:UpdateEvalHistoryI_a:m.BOSave_x:xim.EvalHistoryI


3. Updating parent node total evaluation count recussively and saving history of each node

xi.ag_Total Evaluation_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:EvalI_a:m.BOLoad_x:bod.Evaluation,[ID=xim.BOIID]
xi.m_-:EvalParentID_a:m.SetValue_x:xim.EvalI.FKiParentID
xi.m_-:Recursive_a:m.Recursive_x:xim.EvalParentID
xi.m_--:ChildEvals_a:m.1Click_x:xif.TotalEvaluation,[FKiParentID=xim.EvalParentID]
xi.m_--:EachChild_a:m.Iterate_x:xim.ChildEvals
xi.m_---:ChildTotal_a:m.SetValue_x:xim.EachChild.iTotalEvaluation
xi.s_---:Total_x:{increment|xis.Total,xim.ChildTotal}
xi.m_--:ParentEvalI_a:m.BOLoad_x:bod.Evaluation,[ID=xim.EvalParentID]
xi.m_--:CurrentParentTotal_a:m.SetValue_x:xim.ParentEvalI.iTotalEvaluation
xi.m_--:ParentEvaluation_a:m.SetValue_x:xim.ParentEvalI.iEvaluation
xi.s_--:TotalEval_x:{add|xim.ParentEvaluation,xis.Total}
xi.m_--:SetTotalValue_a:m.SetValue_x:xim.ParentEvalI,[iTotalEvaluation=xim.TotalEval]
xi.m_--:UpdateEvalI_a:m.BOSave_x:xim.ParentEvalI
xi.m_--:SetValue2_a:m.SetLineValue_x:EvalParentID=xim.ParentEvalI.FKiParentID
xi.m_--:SetValue3_a:m.SetLineValue_x:Total=xif.0
xi.m_--:EvalHistoryI_a:m.BOLoad_x:bod.EvaluationHistory
xi.m_--:SetFKEvalID_a:m.SetValue_x:xim.EvalHistoryI,[FKiEvaluationID=xim.ParentEvalI.ID]
xi.m_--:SetPrevious_a:m.SetValue_x:xim.EvalHistoryI,[iPrevious=xim.CurrentParentTotal]
xi.m_--:SetCurrent_a:m.SetValue_x:xim.EvalHistoryI,[iCurrent=xim.TotalEval]
xi.m_--:UpdateEvalHistoryI_a:m.BOSave_x:xim.EvalHistoryI


HAL K2 END

xi.ag_XClientQuestionSetSave_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.s_-:iCustomerID_x:{xi.p|-iClientID}
xi.s_-:QSIID_x:{xi.p|-iQSIID}
xi.m_-:XClientQSI_a:m.BOLoad_x:bod.XClientQuestionSet
xi.m_-:SetFKEvalID_a:m.SetValue_x:xim.XClientQSI,[FKiClientID=xim.iCustomerID]
xi.m_-:SetPrevious_a:m.SetValue_x:xim.XClientQSI,[FKiQSIID=xim.QSIID]
xi.m_-:SaveXClientQSI_a:m.BOSave_x:xim.XClientQSI





xi.ag_Baskets_p.sSessionID,p.sGUID,p.iQuoteID
xi.m_-:QuotesI_a:m.BOLoad_x:bod.Aggregations,[ID=p.iQuoteID]
xi.m_-:BasketBOI_a:m.BOLoad_x:bod.Basket,[FKiCustomerID=xim.QuotesI.FKiCustomerID],[XIDeleted=xif.0]
xi.m_-:BasketID_a:m.SetValue_x:xim.BasketBOI.ID
xi.s_-:QSIID_x:{xi.p|-iQSIID}
xi.m_-:QSI_a:m.LoadQS_x:xim.QSIID
xi.m_-:IfCounteq_a:m.Condition_x:{if|{eq|{xim|BasketID},''},'y','n'}
xi.m_--:BasketI_a:m.BOLoad_x:bod.Basket
xi.m_--:SetValue1_a:m.SetValue_x:xim.BasketI,[FKiCustomerID=xim.QuotesI.FKiCustomerID]
xi.m_--:SetValue2_a:m.SetValue_x:xim.BasketI,[iStatus=xif.10]
xi.m_--:InsertBasketl_a:m.BOSave_x:xim.BasketI
xi.m_--:BasketQuotesI_a:m.BOLoad_x:bod.BasketQuotes
xi.m_--:SetValue3_a:m.SetValue_x:xim.BasketQuotesI,[FKiBasketID=xim.BasketI.id]
xi.m_--:SetValue4_a:m.SetValue_x:xim.BasketQuotesI,[iStatus=xif.10]
xi.m_--:SetValue5_a:m.SetValue_x:xim.BasketQuotesI,[FKiQuoteID=p.iQuoteID]
xi.m_--:SetValue6_a:m.SetValue_x:xim.BasketQuotesI,[rAmount=xim.QuotesI.rPrice]
xi.m_--:SetValue11_a:m.SetValue_x:xim.BasketQuotesI,[sResonForRecommend=xim.QSI.sResonForRecommend]
xi.m_--:InsertBasketQuotesl_a:m.BOSave_x:xim.BasketQuotesI
xi.m_-:IfCountgt_a:m.Condition_x:{if|{gt|{xim|BasketID},0},'y','n'}
xi.m_--:BasketQuotesII_a:m.BOLoad_x:bod.BasketQuotes
xi.m_--:SetValue7_a:m.SetValue_x:xim.BasketQuotesII,[FKiBasketID=xim.BasketBOI.ID]
xi.m_--:SetValue8_a:m.SetValue_x:xim.BasketQuotesII,[iStatus=xif.10]
xi.m_--:QuotesII_a:m.BOLoad_x:bod.Aggregations,[ID=p.iQuoteID]
xi.m_--:SetValue9_a:m.SetValue_x:xim.BasketQuotesII,[FKiQuoteID=p.iQuoteID]
xi.m_--:SetValue10_a:m.SetValue_x:xim.BasketQuotesII,[rAmount=xim.QuotesI.rPrice]
xi.m_--:SetValue12_a:m.SetValue_x:xim.BasketQuotesII,[sResonForRecommend=xim.QSI.sResonForRecommend]
xi.m_--:InsertBasketQuoteslI_a:m.BOSave_x:xim.BasketQuotesII
xi.m_-:SetRecommended_a:m.SetValue_x:xim.QuotesI,[bIsRecommended=xif.1]
xi.m_-:InsertQuotesl_a:m.BOSave_x:xim.QuotesI


xi.m_-:BaksetDemands_a:m.SetValue_x:xim.BasketBOI.sDemands
xi.m_-:IfDemandNull_a:m.Condition_x:{if|{eq|{xim|BaksetDemands},''},'y','n'}
xi.m_--:LeadID_a:m.SetValue_x:xim.QuotesI.FkiLeadID
xi.m_--:oDistributions_a:m.1Click_x:xif.BasketDemandDistributions
xi.m_--:oDistributionI_a:m.Iterate_x:xim.oDistributions
xi.m_---:iDistributionID_a:m.SetValue_x:xim.oDistributionI.ID
xi.m_---:oDistribution_a:m.DistributeBO_x:xim.LeadID,xim.iDistributionID
xi.m_-:IfDemandNotNull_a:m.Condition_x:{if|{ne|{xim|BaksetDemands},''},'y','n'}




xi.m_-:Content_a:m.TemplateMerge_x:xim.CommType.FKiTemplateID,xim.CommType.sStructureCode,xim.sMainBo,xim.BOIID

xi.ag_SaveWhatsappLead_p.sSessionID,p.sGUID
xi.s_-:sMobileNo_x:{xi.p|-sMobileNo}
xi.m_-:ClientI_a:m.BOLoad_x:bod.Customer,[sMobileNo=xim.sMobileNo]
xi.m_-:SVClientMob_a:m.SetValue_x:xim.ClientI,[sMobileNo=xim.sMobileNo]
xi.m_-:InsertClientI_a:m.BOSave_x:xim.ClientI
xi.m_-:ClientID_a:m.SetValue_x:xim.ClientI.ID
xi.m_-:LeadI_a:m.BOLoad_x:bod.Lead_T
xi.m_-:SetValue1_a:m.SetValue_x:xim.LeadI,[sMob=xim.sMobileNo]
xi.m_-:SetValue2_a:m.SetValue_x:xim.LeadI,[FKiQSInstanceID=xim.QSIID]
xi.m_-:SetValue3_a:m.SetValue_x:xim.LeadI,[sName=xif.New]
xi.m_-:SetValue4_a:m.SetValue_x:xim.LeadI,[FKiCustomerID=xim.ClientID]
xi.m_-:InsertLeadI_a:m.BOSave_x:xim.LeadI

Client->Multiple Leads->QSInstance->RiskData




Sendgrid 

xi.ag_SendGridAction_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:CommTransI_a:m.BOLoad_x:bod.CommsTransaction,[ID=xim.BOIID]
xi.m_-:iCommID_a:m.SetValue_x:xim.CommTransI.FKiCommInstanceID
xi.m_-:CommI_a:m.BOLoad_x:bod.XICommunicationI,[ID=xim.iCommID]
xi.m_-:SGAction_a:m.SetValue_x:xim.CommTransI.iType
xi.m_-:IfOpen_a:m.Condition_x:{if|{eq|{xim|SGAction},60},'y','n'}
xi.m_--:CallBOI_a:m.BOLoad_x:bod.Call
xi.m_--:SetName_a:m.SetValue_x:xim.CallBOI,[sNotes=xif.Mail is opened]
xi.s_--:CurrentDate_x:{xi.r|currentdate}
xi.m_--:SetCallDate_a:m.SetValue_x:xim.CallBOI,[dWhen=xim.CurrentDate]
xi.m_--:SetClient_a:m.SetValue_x:xim.CallBOI,[FKiCustomerID=xim.CommI.XIInstanceOriginID]
xi.m_--:SaveCallI_a:m.BOSave_x:xim.CallBOI
xi.m_-:IfClick_a:m.Condition_x:{if|{eq|{xim|SGAction},70},'y','n'}
xi.m_--:SGActionURL_a:m.SetValue_x:xim.CommTransI.sClickedURL
xi.m_--:CallBOI1_a:m.BOLoad_x:bod.Call
xi.m_--:SetName1_a:m.SetValue_x:xim.CallBOI1,[sNotes=xim.SGActionURL]
xi.s_--:CurrentDate1_x:{xi.r|currentdate}
xi.m_--:SetCallDate1_a:m.SetValue_x:xim.CallBOI1,[dWhen=xim.CurrentDate1]
xi.m_--:SetClient1_a:m.SetValue_x:xim.CallBOI1,[FKiCustomerID=xim.CommI.XIInstanceOriginID]
xi.m_--:SaveCallI1_a:m.BOSave_x:xim.CallBOI1

Set Admin Fee

xi.ag_SetAdminFee_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:QuoteI_a:m.BOLoad_x:bod.Aggregations,[ID=BOIID]
xi.m_-:SetFee_a:m.SetValue_x:xim.QuoteI,[rTotalAdmin=xif.30]
xi.m_-:SaveQuoteI_a:m.BOSave_x:xim.QuoteI


xi.ag_SetAdminFee_p.sSessionID,p.sGUID,p.iQuoteID
xi.m_-:QuoteI_a:m.BOLoad_x:bod.Aggregations,[ID=p.iQuoteID]
xi.m_-:QuoteID_a:m.SetValue_x:xim.QuoteI.ID
xi.m_-:oDistributions_a:m.1Click_x:xif.SetAdminFee
xi.m_-:oDistributionI_a:m.Iterate_x:xim.oDistributions
xi.m_--:iDistributionID_a:m.SetValue_x:xim.oDistributionI.ID
xi.m_--:oDistribution_a:m.DistributeBO_x:xim.QuoteID,xim.iDistributionID


Get in touch public qs

xi.ag_Getintouch_p.sSessionID,p.sGUID
xi.s_-:QSIID_x:{xi.p|-iQSIID}
xi.m_-:QSI_a:m.QSLoad_x:xim.QSIID
xi.m_-:sEmail_a:m.SetValue_x:xim.QSI.sEmail
xi.m_-:sMobileNo_a:m.SetValue_x:xim.QSI.sMob
xi.m_-:ClientI_a:m.BOLoad_x:bod.Customer,[sMobileNo=xim.sMobileNo]
xi.m_-:SVClientMob_a:m.SetValue_x:xim.ClientI,[sMobileNo=xim.sMobileNo,sEmail=xim.sEmail]
xi.m_-:InsertClientI_a:m.BOSave_x:xim.ClientI,xif.false
xi.m_-:ClientID_a:m.SetValue_x:xim.ClientI.ID
xi.m_-:LeadI_a:m.BOLoad_x:bod.Lead_T
xi.m_-:SetValue1_a:m.SetValue_x:xim.LeadI,[sMob=xim.sMobileNo,FKiQSInstanceIDXIGUID=xim.QSIID,sName=xif.New,FKiCustomerID=xim.ClientID,sEMail=xim.sEmail]
xi.m_-:InsertLeadI_a:m.BOSave_x:xim.LeadI,xif.false
xi.m_-:bEmail_a:m.SetValue_x:xim.QSI.bContactEmail
xi.m_-:IfEmailYes_a:m.Condition_x:{if|{eq|{xim|bEmail},'true'},'true','false'}
xi.m_--:CommType_a:m.BOLoad_x:bod.XICommunicationType,[sCode=xif.Welcome to Convers]
xi.m_--:CommI_a:m.BOLoad_x:bod.XICommunicationI
xi.m_--:Content_a:m.TemplateMerge_x:xim.CommType.FKiTemplateID,xim.CommType.sStructureCode,xif.Customer,xim.ClientID
xi.m_--:SetFrom_a:m.SetValue_x:xim.CommI,[sFrom=xim.CommType.sFromDefault,sTo=xim.sEmail,sHeader=xim.CommType.sSubject,sContent=xim.Content,iComType=xim.CommType.iMethod,iDirection=xif.20,FKiComTypeID=xim.CommType.FKiRefComType]
xi.m_--:SaveCommI_a:m.BOSave_x:xim.CommI
xi.m_--:CommOut_a:m.Communicationout_x:xim.CommI.ID


xi.m_-:ScriptID_x:xif.f8b8c9b7-32f0-46fa-8b79-6acd19a413e2
xi.ag_DynamicQSD_p.sSessionID,p.sGUID
xi.s_-:BODID_x:{xi.p|-iBODID}
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:ScriptID_x:xif.f8b8c9b7-32f0-46fa-8b79-6acd19a413e2
xi.m_-:RunScript_a:m.RunDynamicScript_x:xim.BODID,xim.BOIID,xim.ScriptID


xi.ag_ProcessCommunication_p.sSessionID,p.sGUID
xi.m_-:AllComms_a:m.1Click_x:xif.Process Communications
xi.m_-:CommI_a:m.Iterate_x:xim.AllComms
xi.m_--:iCommID_a:m.SetValue_x:xim.CommI.ID
xi.m_--:ProcessComm_a:m.ProcessCommunication_x:xim.iCommID

Call for Unassigned Communication

xi.ag_CallforUnassignedComm_p.sSessionID,p.sGUID
xi.s_-:BO_x:{xi.p|-sBO}
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.s_-:CommID_x:{xi.p|-iCommID}
xi.m_-:Object_a:m.BOLoad_x:xim.BO,[ID=xim.BOIID]
xi.m_-:CallBOI_a:m.BOLoad_x:bod.Call
xi.m_-:FKAttr_a:m.GetFKToObject_x:xif.Call,xim.BO
xi.s_-:CurrentDate_x:{xi.r|currentdate}
xi.m_-:SetCallAttr_a:m.SetValue_x:xim.CallBOI,[sNotes=xif.Communication assigned,xim.FKAttr=xim.BOIID,FKiCommIID=xim.CommID,dWhen=xim.CurrentDate,refCallTypeID=xif.23,iActionStatus=xif.0]
xi.m_-:SaveCallI_a:m.BOSave_x:xim.CallBOI
xi.m_-:CommI_a:m.BOLoad_x:bod.XICommunicationI,[ID=xim.CommID]
xi.m_-:SetCommStatus_a:m.SetValue_x:xim.CommI,[iProcessStatus=xif.50]
xi.m_-:SaveCommI_a:m.BOSave_x:xim.CommI


Check customer based on From address and create call

//load conversation
//if conversationid is not null, iterate FK1 to FK5, if there is a definition then we will try to a call to this object(instanceid1 to 5)

//check if conversationid is null

xi.ag_CustomerFromCreateCall_p.sSessionID,p.sGUID
xi.s_-:From_x:{xi.p|-sFrom}
xi.s_-:CommID_x:{xi.p|-iBOIID}
xi.m_-:CommI_a:m.BOLoad_x:bod.XICommunicationI,[ID=xim.CommID]
xi.m_-:ConversationID_a:m.SetValue_x:xim.CommI.FKiConversationID
xi.m_-:IfConversationYes_a:m.Condition_x:{if|{ne|{xim|ConversationID},''},'true','false'}
xi.m_--:ConversationI_a:m.BOLoad_x:bod.ConversationI,[ID=xim.ConversationID]
xi.m_--:FK1_a:m.SetValue_x:xim.ConversationI.FKiInst1ID
xi.m_--:IfFK1notNull_a:m.Condition_x:{if|{ne|{xim|FK1},''},'true','false'}
xi.m_---:ChildPC1_a:m.childpc_x:xif.aaf19a09-571b-4200-8cc9-9d42d15adf50,xim.FK1,xim.ConversationI.FKiDef1ID,xim.CommID
xi.m_--:FK2_a:m.SetValue_x:xim.ConversationI.FKiInst2ID
xi.m_--:IfFK2notNull_a:m.Condition_x:{if|{ne|{xim|FK2},''},'true','false'}
xi.m_---:ChildPC2_a:m.childpc_x:xif.aaf19a09-571b-4200-8cc9-9d42d15adf50,xim.FK2,xim.ConversationI.FKiDef2ID,xim.CommID
xi.m_--:FK3_a:m.SetValue_x:xim.ConversationI.FKiInst3ID
xi.m_--:IfFK3notNull_a:m.Condition_x:{if|{ne|{xim|FK3},''},'true','false'}
xi.m_---:ChildPC3_a:m.childpc_x:xif.aaf19a09-571b-4200-8cc9-9d42d15adf50,xim.FK3,xim.ConversationI.FKiDef3ID,xim.CommID
xi.m_--:FK4_a:m.SetValue_x:xim.ConversationI.FKiInst4ID
xi.m_--:IfFK4notNull_a:m.Condition_x:{if|{ne|{xim|FK4},''},'true','false'}
xi.m_---:ChildPC4_a:m.childpc_x:xif.aaf19a09-571b-4200-8cc9-9d42d15adf50,xim.FK4,xim.ConversationI.FKiDef4ID,xim.CommID
xi.m_--:FK5_a:m.SetValue_x:xim.ConversationI.FKiInst5ID
xi.m_--:IfFK5notNull_a:m.Condition_x:{if|{ne|{xim|FK5},''},'true','false'}
xi.m_---:ChildPC5_a:m.childpc_x:xif.aaf19a09-571b-4200-8cc9-9d42d15adf50,xim.FK5,xim.ConversationI.FKiDef5ID,xim.CommID
xi.m_-:IfConversationNo_a:m.Condition_x:{if|{eq|{xim|ConversationID},''},'true','false'}
xi.m_--:ClientI_a:m.BOLoad_x:bod.Customer,[sEmail=xim.From]
xi.m_--:CustContactCount_a:m.1clickcount_x:xif.Customer Contact for PC,[FKiCustomerID=xim.ClientI.ID]
xi.m_--:IfContactGt1_a:m.Condition_x:{if|{gt|{xim|CustContactCount},'1'},'true','false'}
xi.m_---:SetCommStatus_a:m.SetValue_x:xim.CommI,[iProcessStatus=xif.0]
xi.m_---:SaveCommlI_a:m.BOSave_x:xim.CommI
xi.m_--:IfContactGt1_a:m.Condition_x:{if|{eq|{xim|CustContactCount},'1'},'true','false'}
//if customer contact counts are anything other than 1 we change the status to not processed  
//we need to add in iProcessStatus override and have 100=unassinged and add that to the unassinged 1Query
xi.m_---:CallBOI_a:m.BOLoad_x:bod.Call
xi.m_---:SetCallAttr_a:m.SetValue_x:xim.CallBOI,[FKiCustomerID=xim.ClientI.FKiCustomerID,FKiCommIID=xim.CommID,dWhen=xim.CurrentDate,refCallTypeID=xif.23,iActionStatus=xif.0]
xi.m_---:SaveCallI_a:m.BOSave_x:xim.CallBOI


Child PC for creating call for above PC, find for childpc action

xi.ag_ChildPCForCall_p.sSessionID,p.sGUID
xi.m_-:CallBOI1_a:m.BOLoad_x:bod.Call
xi.s_-:CurrentDate_x:{xi.r|currentdate}
xi.m_-:SetCallAttr_a:m.SetValue_x:xim.CallBOI1,[sNotes=xif.Communication assigned,p.FK1=p.FKiInst1ID,FKiCommIID=p.CommID,dWhen=xim.CurrentDate,refCallTypeID=xif.23,iActionStatus=xif.0]
xi.m_-:SaveCallI_a:m.BOSave_x:xim.CallBOI1



Outbound mail from lead - this is the PC configured on the stream
-Get ConversationID from CommI
-Set FK attributes one for FKiLeadID from Communication FKDID and FKIID
-Create a Call and FK to the Lead and also to the CommI

xi.ag_OutboundMailFromLead_p.sSessionID,p.sGUID
xi.s_-:CommID_x:{xi.p|-iBOIID}
xi.m_-:CommI_a:m.BOLoad_x:bod.XICommunicationI,[ID=xim.CommID]
xi.m_-:ConversationID_a:m.SetValue_x:xim.CommI.FKiConversationID
xi.m_-:FKAttr_a:m.GetFKToObject_x:xif.Call,xim.CommI.XIInstanceDefinitionID
xi.m_-:CallBOI_a:m.BOLoad_x:bod.Call
xi.s_-:CurrentDate_x:{xi.r|currentdate}
xi.m_-:SetCallAttr_a:m.SetValue_x:xim.CallBOI,[xim.FKAttr=xim.BOIID,FKiCommIID=xim.CommID,dWhen=xim.CurrentDate,refCallTypeID=xif.23,iActionStatus=xif.0]
xi.m_-:SaveCallI_a:m.BOSave_x:xim.CallBOI
xi.m_-:Object_a:m.BOLoad_x:xim.CommI.XIInstanceDefinitionID,[ID=xim.CommI.XIInstanceOriginID]
xi.m_-:ConversationI_a:m.BOLoad_x:bod.ConversationI
xi.m_-:SetConversationAttr1_a:m.SetValue_x:xim.ConversationI,[FKiDef1ID=xim.FKAttr, FKiInst1ID=xim.CommI.XIInstanceOriginID]
xi.m_-:SetConversationAttr2_a:m.SetValue_x:xim.ConversationI,[FKiDef2ID=xif.FKiClientID, FKiInst2ID=xim.Object.FKiClientID]
xi.m_-:SetConversationAttr2_a:m.SetValue_x:xim.ConversationI,[FKiDef3ID=xif.FKiACPolicyID, FKiInst3ID=xim.Object.FKiACPolicyID]
xi.m_-:SetConversationAttr2_a:m.SetValue_x:xim.ConversationI,[FKiDef4ID=xif.FKiLeadID, FKiInst4ID=xim.Object.FKiLeadID]
xi.m_-:SaveConversationI_a:m.BOSave_x:xim.ConversationI


Create Task For Call

xi.ag_CreateTaskForCall_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:CallI_a:m.BOLoad_x:bod.Call,[ID=xim.BOIID]
xi.m_-:LeadID_a:m.SetValue_x:xim.CallI.FKiLeadID
xi.m_-:LeadI_a:m.BOLoad_x:bod.Lead_T,[ID=xim.LeadID]
xi.m_-:TaskBOI_a:m.BOLoad_x:bod.ERP_Task
xi.m_-:SetTaskAttr_a:m.SetValue_x:xim.TaskBOI,[FKiCommunicationIID=xim.CallI.FKiCommIID,FKiUserHandlerID=xim.LeadI.FKiUserID]
xi.m_-:SaveTaskI_a:m.BOSave_x:xim.TaskBOI
xi.m_-:TaskID_a:m.SetValue_x:xim.TaskBOI.ID
xi.m_-:SetCallAttr_a:m.SetValue_x:xim.CallI,[FKiTaskID=xim.TaskID]
xi.m_-:SaveCallI_a:m.BOSave_x:xim.CallI
xi.m_-:XTask1_a:m.BOLoad_x:bod.XTask
xi.m_-:SetXTask1Attr_a:m.SetValue_x:xim.XTask1,[FKiTaskID=xim.TaskID, FKiDID=xif.96, FKiID=xim.CallI.ID]
xi.m_-:SaveXTask1_a:m.BOSave_x:xim.XTask1
xi.m_-:XTask2_a:m.BOLoad_x:bod.XTask
xi.m_-:SetXTask1Attr_a:m.SetValue_x:xim.XTask2,[FKiTaskID=xim.TaskID, FKiDID=xif.717, FKiID=xim.LeadID]
xi.m_-:SaveXTask2_a:m.BOSave_x:xim.XTask2



//Task-FKCommIID, UserHandlerID/TeamHandlerID
//XTask to Task, XTask to CalliID and Def, XTask to LeadIID and Def

xi.ag_OutboundCommStream_p.sSessionID,p.sGUID
xi.m_-:Stream_a:m.Communicate_x:xif.4


xi.ag_ImportLeads_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:ImportLead_a:m.ImportLead_x:xim.BOIID


xi.m_-:AllLeads_a:m.1Click_x:xif.BatchLeads,[FKiLeadImportID=xim.BOIID]
xi.m_-:EachLeadI_a:m.Iterate_x:xim.AllLeads
xi.m_--:LeadI_a:m.BOLoad_x:bod.Lead
xi.m_--:SetLeadIAttr_a:m.SetValue_x:xim.LeadI,[sFirstName=xim.EachLeadI.sFirstName,sLastName=xim.EachLeadI.sLastName,sEmail=xim.EachLeadI.sEmail,sMob=xim.EachLeadI.sMob,sPostCode=xim.EachLeadI.sPostCode]
xi.m_--:SaveLeadI_a:m.BOSave_x:xim.LeadI
xi.m_--:SetEachLeadIAttr_a:m.SetValue_x:xim.EachLeadI,[iStatus=xif.10]
xi.m_--:SaveEachLeadI_a:m.BOSave_x:xim.EachLeadI

xi.ag_RunCampaignOnLeads_p.sSessionID,p.sGUID
xi.s_-:BOIID_x:{xi.p|-iBOIID}
xi.m_-:AllLeads_a:m.1Click_x:xif.BatchLeads,[FKiLeadImportID=xim.BOIID]
xi.m_-:EachLeadI_a:m.Iterate_x:xim.AllLeads
xi.m_--:CommI_a:m.BOLoad_x:bod.XICommunicationI
xi.m_--:SetAttr_a:m.SetValue_x:xim.CommI,[sTo=xim.EachLeadI.sMob,iComType=xif.20,iDirection=xif.20,iSendStatus=xif.10]
xi.m_--:SaveCommI_a:m.BOSave_x:xim.CommI

xi.ag_PushToWhatsapp_p.sSessionID,p.sGUID
xi.m_-:AllLeads_a:m.1Click_x:xif.InboundLeads
xi.m_-:EachLeadI_a:m.Iterate_x:xim.AllLeads
xi.m_--:FKiBOIID_a:m.SetValue_x:xim.EachLeadI.ID
xi.m_--:LeadI_a:m.BOLoad_x:bod.Lead,[ID=xim.FKiBOIID]
xi.m_--:sMob_a:m.SetValue_x:xim.LeadI.sMob
xi.m_--:sTemplate_a:m.SetValue_x:xif.HX434af9100db40e4247fb8da9eab7ab54
xi.m_--:URL_a:m.SetValue_x:xif.XIDNA/APIInvoke/PushToWhatsapp
xi.m_--:FKiBODID_a:m.SetValue_x:xif.717
xi.m_--:CallSG_a:m.callom_x:xim.URL,xim.sMob,xim.sTemplate,xim.FKiBODID,xim.FKiBOIID

